import{d as S,j as e,i6 as z,ht as _,i5 as H,r as h,bf as Q,bq as X,hA as Z}from"./strapi-BOe-yMjB.js";import{k as f,T as $,aS as J,aT as ee,aU as te,e as R,q as se,r as W,a3 as ae,m as O,I as ne,aR as oe,a2 as ie,d as L,n as A,M as re,o as U,p as le,z as v,a6 as de,C as ce,t as k,$ as u,aY as V,ah as ue,G as D,K as Y,B as G,h as pe,aq as me,ax as w,b4 as ge,aZ as he,a_ as F,N as fe}from"./App-DqQcSm7H-BCh8RiHX.js";import{u as be}from"./hooks-E5u1mcgM-CgF7U9Yj.js";import{s as ye,u as xe,I as je,g as ve}from"./objects-D6yBsdmx-B7pYF5nx.js";import{F as Se}from"./FieldTypeIcon-CMlNO8PE-B4af-9yt.js";const N=({label:t,isSibling:a=!1})=>e.jsxs(Ce,{background:a?"neutral100":"primary100",display:"inline-flex",gap:3,hasRadius:!0,justifyContent:"space-between",$isSibling:a,"max-height":"3.2rem",maxWidth:"min-content",children:[e.jsxs(f,{gap:3,children:[e.jsx(Me,{alignItems:"center",cursor:"all-scroll",padding:3,children:e.jsx(z,{})}),e.jsx($,{textColor:a?void 0:"primary600",fontWeight:"bold",ellipsis:!0,maxWidth:"7.2rem",children:t})]}),e.jsxs(f,{children:[e.jsx(P,{alignItems:"center",children:e.jsx(_,{})}),e.jsx(P,{alignItems:"center",children:e.jsx(H,{})})]})]}),P=S(f)`
  height: ${({theme:t})=>t.spaces[7]};

  &:last-child {
    padding: 0 ${({theme:t})=>t.spaces[3]};
  }
`,Me=S(P)`
  border-right: 1px solid ${({theme:t})=>t.colors.primary200};

  svg {
    width: 1.2rem;
    height: 1.2rem;
  }
`,Ce=S(f)`
  border: 1px solid
    ${({theme:t,$isSibling:a})=>a?t.colors.neutral150:t.colors.primary200};

  svg {
    width: 1rem;
    height: 1rem;

    path {
      fill: ${({theme:t,$isSibling:a})=>a?void 0:t.colors.primary600};
    }
  }
`,Fe=({name:t})=>{const{formatMessage:a}=R(),d=X(),o=v("Header",p=>p.modified),g=v("Header",p=>p.isSubmitting);return e.jsx(A.Header,{navigationAction:e.jsx(de,{fallback:`../${ce}/${d.slug}`}),primaryAction:e.jsx(k,{size:"S",disabled:!o,type:"submit",loading:g,children:a({id:"global.save",defaultMessage:"Save"})}),subtitle:a({id:u("components.SettingsViewWrapper.pluginHeader.description.list-settings"),defaultMessage:"Define the settings of the list view."}),title:a({id:u("components.SettingsViewWrapper.pluginHeader.title"),defaultMessage:"Configure the view - {name}"},{name:V(t)})})},Ie=["media","richtext","dynamiczone","relation","component","json","blocks"],Re=()=>{const{formatMessage:t,locale:a}=R(),d=ue(a,{sensitivity:"base"}),{schema:o}=O(),g=v("Settings",i=>i.values.layout??[]),p=v("Settings",i=>i.values.settings.defaultSortBy),y=v("Settings",i=>i.onChange),r=h.useMemo(()=>Object.values(g).reduce((i,n)=>(o&&!Ie.includes(o.attributes[n.name].type)&&i.push({value:n.name,label:typeof n.label!="string"?t(n.label):n.label}),i),[]),[t,g,o]).sort((i,n)=>d.compare(i.label,n.label));h.useEffect(()=>{r.findIndex(i=>i.value===p)===-1&&y("settings.defaultSortBy",r[0]?.value)},[p,y,r]);const b=h.useMemo(()=>Te.map(i=>i.map(n=>n.type==="enumeration"?{...n,hint:n.hint?t(n.hint):void 0,label:t(n.label),options:n.name==="settings.defaultSortBy"?r:n.options}:{...n,hint:n.hint?t(n.hint):void 0,label:t(n.label)})),[t,r]);return e.jsxs(f,{direction:"column",alignItems:"stretch",gap:4,children:[e.jsx($,{variant:"delta",tag:"h2",children:t({id:u("containers.SettingPage.settings"),defaultMessage:"Settings"})}),e.jsx(D.Root,{gap:4,children:b.map(i=>i.map(({size:n,...m})=>e.jsx(D.Item,{s:12,col:n,direction:"column",alignItems:"stretch",children:e.jsx(Y,{...m})},m.name)))},"bottom")]})},Te=[[{label:{id:u("form.Input.search"),defaultMessage:"Enable search"},name:"settings.searchable",size:4,type:"boolean"},{label:{id:u("form.Input.filters"),defaultMessage:"Enable filters"},name:"settings.filterable",size:4,type:"boolean"},{label:{id:u("form.Input.bulkActions"),defaultMessage:"Enable bulk actions"},name:"settings.bulkable",size:4,type:"boolean"}],[{hint:{id:u("form.Input.pageEntries.inputDescription"),defaultMessage:"Note: You can override this value in the Collection Type settings page."},label:{id:u("form.Input.pageEntries"),defaultMessage:"Entries per page"},name:"settings.pageSize",options:["10","20","50","100"].map(t=>({value:t,label:t})),size:6,type:"enumeration"},{label:{id:u("form.Input.defaultSort"),defaultMessage:"Default sort attribute"},name:"settings.defaultSortBy",options:[],size:3,type:"enumeration"},{label:{id:u("form.Input.sort.order"),defaultMessage:"Default sort order"},name:"settings.defaultSortOrder",options:["ASC","DESC"].map(t=>({value:t,label:t})),size:3,type:"enumeration"}]],Ee=J().shape({label:ee().required(),sortable:te()}),we=({attribute:t,name:a,onClose:d})=>{const{formatMessage:o}=R(),{toggleNotification:g}=W(),{value:p,onChange:y}=fe(a);if(!p)return console.error("You've opened a field to edit without it being part of the form, this is likely a bug with Strapi. Please open an issue."),g({message:o({id:"content-manager.containers.list-settings.modal-form.error",defaultMessage:"An error occurred while trying to open the form."}),type:"danger"}),null;let c=!["media","relation"].includes(t.type);return"relation"in t&&["oneWay","oneToOne","manyToOne"].includes(t.relation)&&(c=!0),e.jsx(F.Content,{children:e.jsxs(U,{method:"PUT",initialValues:p,validationSchema:Ee,onSubmit:r=>{y(a,r),d()},children:[e.jsx(F.Header,{children:e.jsxs(De,{children:[e.jsx(Se,{type:t.type}),e.jsx(F.Title,{children:o({id:u("containers.list-settings.modal-form.label"),defaultMessage:"Edit {fieldName}"},{fieldName:V(p.label)})})]})}),e.jsx(F.Body,{children:e.jsx(D.Root,{gap:4,children:[{name:"label",label:o({id:u("form.Input.label"),defaultMessage:"Label"}),hint:o({id:u("form.Input.label.inputDescription"),defaultMessage:"This value overrides the label displayed in the table's head"}),size:6,type:"string"},{label:o({id:u("form.Input.sort.field"),defaultMessage:"Enable sort on this field"}),name:"sortable",size:6,type:"boolean"}].filter(r=>r.name!=="sortable"||r.name==="sortable"&&c).map(({size:r,...b})=>e.jsx(D.Item,{s:12,col:r,direction:"column",alignItems:"stretch",children:e.jsx(Y,{...b})},b.name))})}),e.jsxs(F.Footer,{children:[e.jsx(k,{onClick:d,variant:"tertiary",children:o({id:"app.components.Button.cancel",defaultMessage:"Cancel"})}),e.jsx(k,{type:"submit",children:o({id:"global.finish",defaultMessage:"Finish"})})]})]})})},De=S(f)`
  svg {
    width: 3.2rem;
    margin-right: ${({theme:t})=>t.spaces[3]};
  }
`,$e=({attribute:t,index:a,isDraggingSibling:d,label:o,name:g,onMoveField:p,onRemoveField:y,setIsDraggingSibling:c})=>{const[r,b]=h.useState(!1),{formatMessage:i}=R(),[,n]=h.useState(!1),[{isDragging:m},x,M,I,j]=xe(!0,{type:je.FIELD,item:{index:a,label:o,name:g},index:a,onMoveItem:p,onEnd:()=>c(!1)});h.useEffect(()=>{j(ve(),{captureDraggingState:!1})},[j]),h.useEffect(()=>{m&&c(!0)},[m,c]),h.useEffect(()=>{d||n(l=>!l)},[d]);const s=he(M,x);return e.jsxs(ke,{ref:s,children:[m&&e.jsx(N,{label:o}),!m&&d&&e.jsx(N,{isSibling:!0,label:o}),!m&&!d&&e.jsxs(Ae,{borderColor:"neutral150",background:"neutral100",hasRadius:!0,justifyContent:"space-between",onClick:()=>b(!0),children:[e.jsxs(f,{gap:3,children:[e.jsx(Le,{ref:I,"aria-label":i({id:u("components.DraggableCard.move.field"),defaultMessage:"Move {item}"},{item:o}),onClick:l=>l.stopPropagation(),children:e.jsx(z,{})}),e.jsx($,{fontWeight:"bold",children:o})]}),e.jsxs(f,{paddingLeft:3,onClick:l=>l.stopPropagation(),children:[e.jsxs(F.Root,{open:r,onOpenChange:b,children:[e.jsx(F.Trigger,{children:e.jsx(B,{onClick:l=>{l.stopPropagation()},"aria-label":i({id:u("components.DraggableCard.edit.field"),defaultMessage:"Edit {item}"},{item:o}),type:"button",children:e.jsx(_,{width:"1.2rem",height:"1.2rem"})})}),e.jsx(we,{attribute:t,name:`layout.${a}`,onClose:()=>{b(!1)}})]}),e.jsx(B,{onClick:y,"data-testid":`delete-${g}`,"aria-label":i({id:u("components.DraggableCard.delete.field"),defaultMessage:"Delete {item}"},{item:o}),type:"button",children:e.jsx(H,{width:"1.2rem",height:"1.2rem"})})]})]})]})},B=S.button`
  display: flex;
  align-items: center;
  height: ${({theme:t})=>t.spaces[7]};
  color: ${({theme:t})=>t.colors.neutral600};

  &:hover {
    color: ${({theme:t})=>t.colors.neutral700};
  }

  &:last-child {
    padding: 0 ${({theme:t})=>t.spaces[3]};
  }
`,Le=S(B)`
  padding: 0 ${({theme:t})=>t.spaces[3]};
  border-right: 1px solid ${({theme:t})=>t.colors.neutral150};
  cursor: all-scroll;
`,Ae=S(f)`
  max-height: 3.2rem;
  cursor: pointer;
`,ke=S(G)`
  &:last-child {
    padding-right: ${({theme:t})=>t.spaces[3]};
  }
`,Pe=()=>{const{formatMessage:t}=R(),{model:a,schema:d}=O(),[o,g]=h.useState(!1),[p,y]=h.useState(null),c=h.useRef(null),r=v("SortDisplayedFields",s=>s.values.layout??[]),b=v("SortDisplayedFields",s=>s.addFieldRow),i=v("SortDisplayedFields",s=>s.removeFieldRow),n=v("SortDisplayedFields",s=>s.moveFieldRow),{metadata:m}=pe(a,{selectFromResult:({data:s})=>({metadata:s?.contentType.metadatas??{}})}),x=h.useMemo(()=>{if(!d)return[];const s=r.map(l=>l.name);return Object.entries(d.attributes).reduce((l,[C,T])=>{if(!s.includes(C)&&me(T)){const{list:E}=m[C];l.push({name:C,label:E.label||C,sortable:E.sortable})}return l},[])},[m,r,d]),M=s=>{y("add"),b("layout",s)},I=s=>{y("remove"),i("layout",s)},j=(s,l)=>{n("layout",s,l)};return h.useEffect(()=>{p==="add"&&c?.current&&(c.current.scrollLeft=c.current.scrollWidth)},[p]),e.jsxs(f,{alignItems:"stretch",direction:"column",gap:4,children:[e.jsx($,{variant:"delta",tag:"h2",children:t({id:u("containers.SettingPage.view"),defaultMessage:"View"})}),e.jsxs(f,{padding:4,borderColor:"neutral300",borderStyle:"dashed",borderWidth:"1px",hasRadius:!0,children:[e.jsx(G,{flex:"1",overflow:"auto hidden",ref:c,children:e.jsx(f,{gap:3,children:r.map((s,l)=>e.jsx($e,{index:l,isDraggingSibling:o,onMoveField:j,onRemoveField:()=>I(l),setIsDraggingSibling:g,...s,attribute:d.attributes[s.name],label:typeof s.label=="object"?t(s.label):s.label},s.name))})}),e.jsxs(w.Root,{children:[e.jsxs(w.Trigger,{paddingLeft:2,paddingRight:2,justifyContent:"center",endIcon:null,disabled:x.length===0,variant:"tertiary",children:[e.jsx(ge,{tag:"span",children:t({id:u("components.FieldSelect.label"),defaultMessage:"Add a field"})}),e.jsx(Z,{"aria-hidden":!0,focusable:!1,style:{position:"relative",top:2}})]}),e.jsx(w.Content,{children:x.map(s=>e.jsx(w.Item,{onSelect:()=>M(s),children:typeof s.label=="object"?t(s.label):s.label},s.name))})]})]})]})},Be=()=>{const{formatMessage:t}=R(),{trackUsage:a}=se(),{toggleNotification:d}=W(),{_unstableFormatAPIError:o}=ae(),{model:g,collectionType:p}=O(),{isLoading:y,list:c,edit:r}=ne(),[b]=oe(),i=async m=>{try{a("willSaveContentTypeLayout");const x=m.layout??[],M=Object.entries(r.metadatas).reduce((j,[s,l])=>{const{mainField:C,...T}=c.metadatas[s],{label:E,sortable:q}=x.find(K=>K.name===s)??{};return j[s]={edit:l,list:{...T,label:E||T.label,sortable:q||T.sortable}},j},{}),I=await b({layouts:{edit:r.layout.flatMap(j=>j.map(s=>s.map(({name:l,size:C})=>({name:l,size:C})))),list:x.map(j=>j.name)},settings:ye(m.settings,"displayName",void 0),metadatas:M,uid:g});"data"in I?(a("didEditListSettings"),d({type:"success",message:t({id:"notification.success.saved",defaultMessage:"Saved"})})):d({type:"danger",message:o(I.error)})}catch(x){console.error(x),d({type:"danger",message:t({id:"notification.error",defaultMessage:"An error occurred"})})}},n=h.useMemo(()=>({layout:c.layout.map(({label:m,sortable:x,name:M})=>({label:typeof m=="string"?m:t(m),sortable:x,name:M})),settings:c.settings}),[t,c.layout,c.settings]);return p===ie?e.jsx(Q,{to:`/single-types/${g}`}):y?e.jsx(L.Loading,{}):e.jsxs(A.Root,{children:[e.jsx(L.Title,{children:`Configure ${c.settings.displayName} List View`}),e.jsx(re,{children:e.jsxs(U,{initialValues:n,onSubmit:i,method:"PUT",children:[e.jsx(Fe,{collectionType:p,model:g,name:c.settings.displayName??""}),e.jsx(A.Content,{children:e.jsxs(f,{alignItems:"stretch",background:"neutral0",direction:"column",gap:6,hasRadius:!0,shadow:"tableShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:[e.jsx(Re,{}),e.jsx(le,{}),e.jsx(Pe,{})]})})]})})]})},We=()=>{const t=be(a=>a.admin_app.permissions.contentManager?.collectionTypesConfigurations);return e.jsx(L.Protect,{permissions:t,children:e.jsx(Be,{})})};export{Be as ListConfiguration,We as ProtectedListConfiguration};
