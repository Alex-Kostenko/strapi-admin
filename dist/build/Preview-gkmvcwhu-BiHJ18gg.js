import{cx as b,j as e,cy as j,cz as P,bq as f,i as y,P as l,B as g,cB as C,u as m,aV as x,r as k,cF as B,cw as L,ez as M,cC as D,cD as T,F as h,g as F,bG as I,T as w,I as v,dJ as R,au as E,eA as p,bz as H,be as z,bY as N}from"./strapi-B5tTVWvh.js";import{getDocumentStatus as S}from"./EditViewPage-CA98g5_g-vB_Gbh6-.js";import"./Field-B2C1tq9_-mQnQi3yP.js";import"./Relations-7ItTFWp7-Cq9Io3iR.js";import"./useDragAndDrop-DdHgKsqq-WkuHQhD6.js";import"./relations-sRERvWmr-aidVlejF.js";import"./getEmptyImage-CjqolaH3.js";import"./ComponentIcon-u4bIXTFY-BuDDhcaO.js";import"./objects-D6yBsdmx-B1P2hswY.js";import"./useDebounce-DmuSJIF3-0jJNjie5.js";const A=()=>{const s=u("PreviewContent",n=>n.url),{formatMessage:r}=m();return e.jsx(g,{src:s,title:r({id:"content-manager.preview.panel.title",defaultMessage:"Preview"}),width:"100%",height:"100%",borderWidth:0,tag:"iframe"})},q=()=>{const[{query:s}]=x(),r=E(),{formatMessage:n}=m(),o=p("BackButton",i=>i.canGoBack),c=p("BackButton",i=>i.goBack),d=p("BackButton",i=>i.history),a={pathname:"..",search:H.stringify(s,{encode:!1})},t=i=>{i.preventDefault(),o?c():r(a)};return e.jsx(v,{tag:z,to:d.at(-1)??a,onClick:t,label:n({id:"content-manager.preview.header.close",defaultMessage:"Close preview"}),children:e.jsx(N,{})})},G=s=>{switch(s){case"draft":return{background:"secondary100",border:"secondary200",text:"secondary700",message:{id:"content-manager.containers.List.draft",defaultMessage:"Draft"}};case"modified":return{background:"alternative100",border:"alternative200",text:"alternative700",message:{id:"content-manager.containers.List.modified",defaultMessage:"Modified"}};case"published":default:return{background:"success100",border:"success200",text:"success700",message:{id:"content-manager.containers.List.published",defaultMessage:"Published"}}}},U=()=>{const{formatMessage:s}=m(),r=u("PreviewHeader",t=>t.document),n=u("PreviewHeader",t=>t.schema),o=u("PreviewHeader",t=>t.meta),c=n?.options?.draftAndPublish??!1,d=S(r,o),a=G(d);return c?e.jsx(g,{background:a.background,borderStyle:"solid",borderWidth:"1px",borderColor:a.border,hasRadius:!0,paddingLeft:"6px",paddingRight:"6px",paddingTop:"2px",paddingBottom:"2px",children:e.jsx(w,{variant:"pi",fontWeight:"bold",textColor:a.text,children:s(a.message)})}):null},W=()=>{const s=u("PreviewHeader",t=>t.mainField),n=u("PreviewHeader",t=>t.document)[s],{formatMessage:o}=m(),{toggleNotification:c}=F(),{copy:d}=I(),a=()=>{d(window.location.href),c({message:o({id:"content-manager.preview.copy.success",defaultMessage:"Copied preview link"}),type:"success"})};return e.jsxs(h,{justifyContent:"space-between",background:"neutral0",padding:2,borderColor:"neutral150",tag:"header",children:[e.jsxs(h,{gap:3,children:[e.jsx(q,{}),e.jsx(w,{tag:"h1",fontWeight:600,fontSize:2,children:n}),e.jsx(U,{})]}),e.jsx(v,{type:"button",label:o({id:"preview.copy.label",defaultMessage:"Copy preview link"}),onClick:a,children:e.jsx(R,{})})]})},[V,u]=b("PreviewPage"),$=()=>{const{formatMessage:s}=m(),{slug:r,id:n,collectionType:o}=f(),[{query:c}]=x(),d=k.useMemo(()=>B(c),[c]);if(!o)throw new Error("Could not find collectionType in url params");if(!r)throw new Error("Could not find model in url params");if(o===L&&!n)throw new Error("Could not find documentId in url params");const a=M({params:{contentType:r},query:{documentId:n,locale:d.locale,status:d.status}}),t=D({model:r,collectionType:o,documentId:n,params:d}),i=T(r);return t.isLoading||a.isLoading||i.isLoading?e.jsx(l.Loading,{}):a.error||i.error||!t.document||!t.meta||!t.schema?e.jsx(l.Error,{}):a.data?.data?.url?e.jsxs(e.Fragment,{children:[e.jsx(l.Title,{children:s({id:"content-manager.preview.page-title",defaultMessage:"{contentType} preview"},{contentType:i.edit.settings.displayName})}),e.jsx(V,{url:a.data.data.url,mainField:i.edit.settings.mainField,document:t.document,meta:t.meta,schema:t.schema,children:e.jsxs(h,{direction:"column",height:"100%",alignItems:"stretch",children:[e.jsx(W,{}),e.jsx(A,{})]})})]}):e.jsx(l.NoData,{})},O=()=>{const{slug:s}=f(),{permissions:r=[],isLoading:n,error:o}=y([{action:"plugin::content-manager.explorer.read",subject:s}]);return n?e.jsx(l.Loading,{}):o||!s?e.jsx(g,{height:"100vh",width:"100vw",position:"fixed",top:0,left:0,zIndex:2,background:"neutral0",children:e.jsx(l.Error,{})}):e.jsx(g,{height:"100vh",width:"100vw",position:"fixed",top:0,left:0,zIndex:2,background:"neutral0",children:e.jsx(l.Protect,{permissions:r,children:({permissions:c})=>e.jsx(C,{permissions:c,children:e.jsx($,{})})})})},ae=()=>e.jsx(j,{children:e.jsx(P,{children:e.jsx(O,{})})});export{ae as ProtectedPreviewPage,u as usePreviewContext};
