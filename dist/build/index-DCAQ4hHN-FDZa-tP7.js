const __vite__fileDeps=["index-C_cWV2yS-CEP-xI9o.js","strapi-B5tTVWvh.js","strapi-COJtagOC.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{V as p,fp as J,fq as A,fr as ze,d as X,r as v,bB as Ge,fs as He,aV as q,u as C,ft as c,j as e,P as R,R as Ne,a as xe,B as O,T as ee,au as _e,fu as We,at as Me,br as Se,fv as Ke,fw as P,fx as Ye,fy as Ze,fz as Je,fA as Xe,fB as es,fC as E,fD as ss,b as $,ah as ke,fE as ts,I as _,be as as,bz as Le,d6 as ns,fF as os,dw as is,bl as rs,fG as ls,fH as ds,O as Y,fI as cs,a2 as us,fJ as fs,fK as gs,F as Q,a1 as ps,ba as hs,fL as ms,aY as W,fM as xs,fN as js,fO as bs,fP as ys,fQ as vs,c4 as Cs,K as k,bk as Z,ar as je,as as Fs,fR as Ms,fS as be,fT as Ss,fU as ks,c as Ls,aa as Rs,ab as ws,fV as As,D as ye,w as Es,C as Ts,a4 as y,ds as Ds,fW as Bs,aZ as Is,H as Ps,J as $s,G as ve,fX as qs,g as Os,X as Qs,Y as Vs,a0 as Us,fY as K,fZ as zs,eQ as Gs}from"./strapi-B5tTVWvh.js";const Hs=(s,{pathname:a,query:n})=>{let o=[{id:null,label:{id:c("plugin.name"),defaultMessage:"Media Library"},href:s?E(a,n||{}):void 0}];return s?.parent&&typeof s?.parent!="number"&&s?.parent?.parent&&o.push([]),s?.parent&&typeof s.parent!="number"&&o.push({id:s.parent.id,label:s.parent.name,href:E(a,n||{},{folder:s.parent.id?.toString(),folderPath:s.parent.path})}),s&&o.push({id:s.id,label:s.name}),o},Ns=s=>{const{id:a}=ys();return e.jsx(O,{position:"relative",zIndex:2,children:e.jsx(ke,{"aria-labelledby":`${a}-title`,...s})})},Re=({selected:s,onSuccess:a})=>{const{formatMessage:n}=C(),{remove:o}=As(),d=async()=>{await o(s),a()};return e.jsxs(ye.Root,{children:[e.jsx(ye.Trigger,{children:e.jsx(k,{variant:"danger-light",size:"S",startIcon:e.jsx(Es,{}),children:n({id:"global.delete",defaultMessage:"Delete"})})}),e.jsx(Ts,{onConfirm:d})]})};Re.propTypes={selected:p.arrayOf(J,A).isRequired,onSuccess:p.func.isRequired};const _s=()=>{const{formatMessage:s}=C(),{toggleNotification:a}=Os(),n=Qs(),{post:o}=Vs(),i=Us(({destinationFolderId:h,filesAndFolders:g})=>{const l=g.reduce((u,b)=>{const{id:r,type:S}=b,m=S==="asset"?"fileIds":"folderIds";return u[m]||(u[m]=[]),u[m].push(r),u},{});return o("/upload/actions/bulk-move",{...l,destinationFolderId:h})},{onSuccess(h){const{data:{data:g}}=h;g?.files?.length>0&&(n.refetchQueries([K,"assets"],{active:!0}),n.refetchQueries([K,"asset-count"],{active:!0})),n.refetchQueries([K,"folders"],{active:!0}),a({type:"success",message:s({id:c("modal.move.success-label"),defaultMessage:"Elements have been moved successfully."})})}});return{...i,move:(h,g)=>i.mutateAsync({destinationFolderId:h,filesAndFolders:g})}},Ws=({onClose:s,selected:a=[],currentFolder:n})=>{const{formatMessage:o}=C(),{data:d,isLoading:i}=Bs(),{move:f}=_s();if(!d)return null;const h=async(l,{setErrors:u})=>{try{if(typeof l.destination!="string"){const b=l.destination.value;await f(b,a),s()}}catch(b){const r=zs(b);if(r&&"errors"in r){const S=r.errors?.reduce((m,T)=>(m[T.values?.path?.length||"destination"]=T.defaultMessage,m),{});Gs(S)||u(S)}}};if(i)return e.jsx(y.Content,{children:e.jsx(y.Body,{children:e.jsx(Q,{justifyContent:"center",paddingTop:4,paddingBottom:4,children:e.jsx(Is,{children:o({id:c("content.isLoading"),defaultMessage:"Content is loading."})})})})});const g={destination:{value:n?.id||"",label:n?.name||d[0].label}};return e.jsx(y.Content,{children:e.jsx(Ps,{validateOnChange:!1,onSubmit:h,initialValues:g,children:({values:l,errors:u,setFieldValue:b})=>e.jsxs($s,{noValidate:!0,children:[e.jsx(y.Header,{children:e.jsx(y.Title,{children:o({id:c("modal.folder.move.title"),defaultMessage:"Move elements to"})})}),e.jsx(y.Body,{children:e.jsx(Y.Root,{gap:4,children:e.jsx(Y.Item,{xs:12,col:12,direction:"column",alignItems:"stretch",children:e.jsxs(ve.Root,{id:"folder-destination",children:[e.jsx(ve.Label,{children:o({id:c("form.input.label.folder-location"),defaultMessage:"Location"})}),e.jsx(qs,{options:d,onChange:r=>{b("destination",r)},defaultValue:typeof l.destination!="string"?l.destination:void 0,name:"destination",menuPortalTarget:document.querySelector("body"),inputId:"folder-destination",error:u?.destination,ariaErrorMessage:"destination-error"}),u.destination&&e.jsx(ee,{variant:"pi",tag:"p",textColor:"danger600",children:u.destination})]})})})}),e.jsxs(y.Footer,{children:[e.jsx(y.Close,{children:e.jsx(k,{variant:"tertiary",name:"cancel",children:o({id:"cancel",defaultMessage:"Cancel"})})}),e.jsx(k,{type:"submit",loading:i,children:o({id:"modal.folder.move.submit",defaultMessage:"Move"})})]})]})})})},se=({selected:s,onSuccess:a,currentFolder:n})=>{const{formatMessage:o}=C(),[d,i]=v.useState(!1),f=()=>{i(!1),a()};return e.jsxs(y.Root,{open:d,onOpenChange:i,children:[e.jsx(y.Trigger,{children:e.jsx(k,{variant:"secondary",size:"S",startIcon:e.jsx(Ds,{}),children:o({id:"global.move",defaultMessage:"Move"})})}),e.jsx(Ws,{currentFolder:n,onClose:f,selected:s})]})};se.defaultProps={currentFolder:void 0,selected:[]};se.propTypes={onSuccess:p.func.isRequired,currentFolder:A,selected:p.arrayOf(J,A)};const te=({selected:s,onSuccess:a,currentFolder:n})=>{const{formatMessage:o}=C(),d=s.reduce(function(i,f){return f?.type==="folder"?i+f.files.count:i+1},0);return e.jsxs(Q,{gap:2,paddingBottom:5,children:[e.jsx(ee,{variant:"epsilon",textColor:"neutral600",children:o({id:c("list.assets.selected"),defaultMessage:"{numberFolders, plural, one {1 folder} other {# folders}} - {numberAssets, plural, one {1 asset} other {# assets}} selected"},{numberFolders:s.filter(({type:i})=>i==="folder").length,numberAssets:d})}),e.jsx(Re,{selected:s,onSuccess:a}),e.jsx(se,{currentFolder:n,selected:s,onSuccess:a})]})};te.defaultProps={currentFolder:void 0,selected:[]};te.propTypes={onSuccess:p.func.isRequired,currentFolder:A,selected:p.arrayOf(J,A)};const Ks=({isFiltering:s,canCreate:a,canRead:n})=>s?{id:"list.assets-empty.title-withSearch",defaultMessage:"There are no elements with the applied filters"}:n?a?{id:"list.assets.empty-upload",defaultMessage:"Upload your first assets..."}:{id:"list.assets.empty",defaultMessage:"Media Library is empty"}:{id:"header.actions.no-permissions",defaultMessage:"No permissions to view"},we=({canCreate:s,isFiltering:a,canRead:n,onActionClick:o})=>{const{formatMessage:d}=C(),i=Ks({isFiltering:a,canCreate:s,canRead:n});return e.jsx(vs,{icon:n?void 0:Cs,action:s&&!a&&e.jsx(k,{variant:"secondary",startIcon:e.jsx(Z,{}),onClick:o,children:d({id:c("header.actions.add-assets"),defaultMessage:"Add new assets"})}),content:d({...i,id:c(i.id)})})};we.propTypes={canCreate:p.bool.isRequired,canRead:p.bool.isRequired,isFiltering:p.bool.isRequired,onActionClick:p.func.isRequired};const Ys=()=>{const[s,a]=v.useState(!1),{formatMessage:n}=C(),{trackUsage:o}=Se(),[{query:d},i]=q(),f=d?.filters?.$and||[],h=l=>{i({filters:{$and:l},page:1})},g=l=>{o("didFilterMediaLibraryElements",{location:"content-manager",filter:Object.keys(l[l.length-1])[0]}),i({filters:{$and:l},page:1})};return e.jsxs(je.Root,{open:s,onOpenChange:a,children:[e.jsx(je.Trigger,{children:e.jsx(k,{variant:"tertiary",startIcon:e.jsx(Fs,{}),size:"S",children:n({id:"app.utils.filters",defaultMessage:"Filters"})})}),e.jsx(Ms,{displayedFilters:be,filters:f,onSubmit:g,onToggle:a}),e.jsx(Ss,{appliedFilters:f,filtersSchema:be,onRemoveFilter:h})]})},ae=({breadcrumbs:s,canCreate:a,folder:n,onToggleEditFolderDialog:o,onToggleUploadAssetDialog:d})=>{const{formatMessage:i}=C(),{pathname:f}=Me(),[{query:h}]=q(),g={...h,folder:n?.parent?.id??void 0,folderPath:n?.parent?.path??void 0};return e.jsx($.Header,{title:i({id:c("plugin.name"),defaultMessage:"Media Library"}),subtitle:s&&n&&e.jsx(ks,{tag:"nav",label:i({id:c("header.breadcrumbs.nav.label"),defaultMessage:"Folders navigation"}),breadcrumbs:s,currentFolderId:n?.id}),navigationAction:n&&e.jsx(Ls,{tag:Rs,startIcon:e.jsx(ws,{}),to:`${f}?${Le.stringify(g,{encode:!1})}`,children:i({id:c("header.actions.folder-level-up"),defaultMessage:"Back"})}),primaryAction:a&&e.jsxs(Q,{gap:2,children:[e.jsx(k,{startIcon:e.jsx(Z,{}),variant:"secondary",onClick:o,children:i({id:c("header.actions.add-folder"),defaultMessage:"Add new folder"})}),e.jsx(k,{startIcon:e.jsx(Z,{}),onClick:d,children:i({id:c("header.actions.add-assets"),defaultMessage:"Add new assets"})})]})})};ae.defaultProps={breadcrumbs:!1,folder:null};ae.propTypes={breadcrumbs:p.oneOfType([ze,p.bool]),canCreate:p.bool.isRequired,folder:A,onToggleEditFolderDialog:p.func.isRequired,onToggleUploadAssetDialog:p.func.isRequired};const Zs=X(O)`
  height: 3.2rem;
  display: flex;
  align-items: center;
`,Ce=X(ee)`
  max-width: 100%;
`,Fe=X(O)`
  svg {
    path {
      fill: ${({theme:s})=>s.colors.neutral500};
    }
  }
`,Js=()=>{const s=_e(),{canRead:a,canCreate:n,canUpdate:o,canCopyLink:d,canDownload:i,canConfigureView:f,isLoading:h}=We(),g=v.useRef(),{formatMessage:l}=C(),{pathname:u}=Me(),{trackUsage:b}=Se(),[{query:r},S]=q(),m=!!(r._q||r.filters),[T,Ae]=Ke(Ye.view,P.GRID),L=T===P.GRID,{data:F,isLoading:Ee,errors:Te}=Ze({skipWhen:!a,query:r}),{data:De,isLoading:Be,errors:Ie}=Je({enabled:a&&F?.pagination?.page===1&&!Xe(r),query:r}),{data:V,isLoading:ne,error:Pe}=es(r?.folder,{enabled:a&&!!r?.folder});Pe?.response?.status===404&&s(u);const D=De?.map(t=>({...t,type:"folder",folderURL:E(u,r,t.id),isSelectable:o}))??[],x=D?.length||0,B=F?.results?.map(t=>({...t,type:"asset",isSelectable:o}))||[],j=B?.length??0,$e=F?.pagination?.total,qe=ne||Be||h||Ee,[oe,Oe]=v.useState(!1),[ie,re]=v.useState(!1),[U,z]=v.useState(void 0),[G,le]=v.useState(void 0),[M,{selectOne:I,selectAll:de}]=ss(["type","id"],[]),ce=M?.length>0&&M?.length!==j+x,H=()=>Oe(t=>!t),ue=({created:t=!1}={})=>{t&&r?.page!=="1"&&S({...r,page:1}),re(w=>!w)},fe=(t,w)=>{t&&b("didSelectAllMediaLibraryElements"),de(w)},ge=t=>{b("didSortMediaLibraryElements",{location:"upload",sort:t}),S({sort:t})},pe=t=>{le(t),re(!0)},Qe=t=>{le(null),ue(t),g.current&&g.current.focus()},he=t=>{t===j&&F.pagination.page===F.pagination.pageCount&&F.pagination.page>1&&S({...r,page:F.pagination.page-1})},Ve=()=>{de(),he(M.length)};return qe?e.jsx(R.Loading,{}):Te||Ie?e.jsx(R.Error,{}):e.jsxs($.Root,{children:[e.jsxs(R.Main,{children:[e.jsx(ae,{breadcrumbs:!ne&&Hs(V,{pathname:u,query:r}),canCreate:n,onToggleEditFolderDialog:ue,onToggleUploadAssetDialog:H,folder:V}),e.jsx($.Action,{startActions:e.jsxs(e.Fragment,{children:[o&&L&&(j>0||x>0)&&e.jsx(Zs,{paddingLeft:2,paddingRight:2,background:"neutral0",hasRadius:!0,borderColor:"neutral200",children:e.jsx(ke,{"aria-label":l({id:c("bulk.select.label"),defaultMessage:"Select all folders & assets"}),checked:ce?"indeterminate":(j>0||x>0)&&M.length===j+x,onCheckedChange:t=>fe(t,[...B,...D])})}),a&&L&&e.jsx(ts,{value:r?.sort,onChangeSort:ge}),a&&e.jsx(Ys,{})]}),endActions:e.jsxs(e.Fragment,{children:[f?e.jsx(Fe,{paddingTop:1,paddingBottom:1,children:e.jsx(_,{tag:as,to:{pathname:`${u}/configuration`,search:Le.stringify(r,{encode:!1})},label:l({id:"app.links.configure-view",defaultMessage:"Configure the view"}),children:e.jsx(ns,{})})}):null,e.jsx(Fe,{paddingTop:1,paddingBottom:1,children:e.jsx(_,{label:l(L?{id:c("view-switch.list"),defaultMessage:"List View"}:{id:c("view-switch.grid"),defaultMessage:"Grid View"}),onClick:()=>Ae(L?P.LIST:P.GRID),children:L?e.jsx(os,{}):e.jsx(is,{})})}),e.jsx(rs,{label:l({id:c("search.label"),defaultMessage:"Search for an asset"}),trackedEvent:"didSearchMediaLibraryElements",trackedEventDetails:{location:"upload"}})]})}),e.jsxs($.Content,{children:[M.length>0&&e.jsx(te,{currentFolder:V,selected:M,onSuccess:Ve}),x===0&&j===0&&e.jsx(we,{canCreate:n,canRead:a,isFiltering:m,onActionClick:H}),a&&!L&&(j>0||x>0)&&e.jsx(ls,{assetCount:j,folderCount:x,indeterminate:ce,onChangeSort:ge,onChangeFolder:(t,w)=>s(E(u,r,{folder:t,folderPath:w})),onEditAsset:z,onEditFolder:pe,onSelectOne:I,onSelectAll:fe,rows:[...D,...B],selected:M,shouldDisableBulkSelect:!o,sortQuery:r?.sort??""}),a&&L&&e.jsxs(e.Fragment,{children:[x>0&&e.jsx(ds,{title:(m&&j>0||!m)&&l({id:c("list.folders.title"),defaultMessage:"Folders ({count})"},{count:x})||"",children:D.map(t=>{const Ue=!!M.filter(({type:N})=>N==="folder").find(N=>N.id===t.id),me=E(u,r,{folder:t?.id,folderPath:t?.path});return e.jsx(Y.Item,{col:3,direction:"column",alignItems:"stretch",children:e.jsx(cs,{ref:G&&t.id===G.id?g:void 0,ariaLabel:t.name,id:`folder-${t.id}`,to:me,startAction:I&&t.isSelectable?e.jsx(Ns,{"data-testid":`folder-checkbox-${t.id}`,checked:Ue,onCheckedChange:()=>I(t)}):null,cardActions:e.jsx(_,{"aria-label":l({id:c("list.folder.edit"),defaultMessage:"Edit folder"}),onClick:()=>pe(t),children:e.jsx(us,{})}),children:e.jsx(fs,{children:e.jsx(gs,{to:me,children:e.jsxs(Q,{tag:"h2",direction:"column",alignItems:"start",maxWidth:"100%",children:[e.jsxs(Ce,{fontWeight:"semiBold",textColor:"neutral800",ellipsis:!0,children:[t.name,e.jsx(ps,{children:":"})]}),e.jsx(Ce,{tag:"span",textColor:"neutral600",variant:"pi",ellipsis:!0,children:l({id:c("list.folder.subtitle"),defaultMessage:"{folderCount, plural, =0 {# folder} one {# folder} other {# folders}}, {filesCount, plural, =0 {# asset} one {# asset} other {# assets}}"},{folderCount:t.children.count,filesCount:t.files.count})})]})})})})},`folder-${t.id}`)})}),j>0&&x>0&&e.jsx(O,{paddingTop:6,paddingBottom:4,children:e.jsx(hs,{})}),j>0&&e.jsx(ms,{assets:B,onEditAsset:z,onSelectAsset:I,selectedAssets:M.filter(({type:t})=>t==="asset"),title:(!m||m&&x>0)&&F?.pagination?.page===1&&l({id:c("list.assets.title"),defaultMessage:"Assets ({count})"},{count:$e})||""})]}),e.jsxs(W.Root,{...F.pagination,children:[e.jsx(W.PageSize,{}),e.jsx(W.Links,{})]})]})]}),oe&&e.jsx(xs,{open:oe,onClose:H,trackedLocation:"upload",folderId:r?.folder}),ie&&e.jsx(js,{open:ie,onClose:Qe,folder:G,parentFolderId:r?.folder,location:"upload"}),U&&e.jsx(bs,{onClose:t=>{t===null&&he(1),z(void 0)},open:!!U,asset:U,canUpdate:o,canCopyLink:d,canDownload:i,trackedLocation:"upload"})]})},Xs=v.lazy(()=>Ge(()=>import("./index-C_cWV2yS-CEP-xI9o.js"),__vite__mapDeps([0,1,2]))),st=()=>{const{config:{isLoading:s,isError:a,data:n}}=He(),[{rawQuery:o},d]=q(),{formatMessage:i}=C(),f=i({id:c("plugin.name"),defaultMessage:"Media Library"});return v.useEffect(()=>{s||a||o||d({sort:n.sort,page:1,pageSize:n.pageSize})},[s,a,n,o,d]),s?e.jsxs(e.Fragment,{children:[e.jsx(R.Title,{children:f}),e.jsx(R.Loading,{})]}):e.jsx(R.Main,{children:o?e.jsx(v.Suspense,{fallback:e.jsx(R.Loading,{}),children:e.jsxs(Ne,{children:[e.jsx(xe,{index:!0,element:e.jsx(Js,{})}),e.jsx(xe,{path:"configuration",element:e.jsx(Xs,{config:n})})]})}):null})};export{st as default};
